<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Beast Burger Spin</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
            background: #7a1824;
            color: #fff;
            text-align: center;
            overflow-x: hidden;
        }

        body::before {
            content: "BEAST BURGER BEAST BURGER BEAST BURGER BEAST BURGER ";
            position: fixed;
            top: -15%;
            left: -25%;
            width: 180%;
            height: 180%;
            font-size: 80px;
            font-weight: 900;
            color: rgba(0,0,0,0.12);
            transform: rotate(-28deg);
            z-index: -1;
        }

        .logo {
            width: 135px;
            margin: 25px auto 10px;
            display: block;
        }

        .machine {
            width: 92%;
            max-width: 480px;
            margin: 35px auto 0;
            background: linear-gradient(180deg,#ff8a20,#ff5a00);
            padding: 28px 20px 40px;
            border-radius: 38px;
            box-shadow: 0 0 50px rgba(0,0,0,0.45);
            position: relative;
        }

        .screen {
            background: #0a0607;
            border-radius: 28px;
            padding: 30px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reel {
            width: 90px;
            height: 90px;
            background: #1a0f13;
            border-radius: 20px;
            font-size: 52px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @media(max-width:600px) {
            .reel {
                width: 72px;
                height: 72px;
                font-size: 44px;
            }
        }

        /* ğŸ”¥ Ø§Ù„Ø°Ø±Ø§Ø¹ */
        .lever-box {
            position: absolute;
            left: -5px;
            bottom: -40px;
            transform: rotate(12deg);
        }

        .lever {
            cursor: pointer;
            width: 90px;
            transition: .25s ease;
        }

        .lever-stick {
            width: 16px;
            height: 90px;
            background: #000;
            border-radius: 10px;
            margin: 0 auto;
        }

        .lever-ball {
            width: 55px;
            height: 55px;
            background: #ffb58d;
            border-radius: 50%;
            box-shadow: 0 8px 16px rgba(0,0,0,0.55);
            margin-top: -12px;
        }

        .instructions {
            margin-top: 50px;
            font-size: 18px;
            line-height: 1.7;
            padding: 0 10px;
        }

        #popup,
        #phonePopup {
            position: fixed;
            top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.85);
            display:none;
            justify-content:center;
            align-items:center;
            z-index:9999;
        }

        .popup-box,
        .phone-box {
            background:#0f0a0a;
            border:3px solid #ff6a00;
            padding:25px;
            border-radius:18px;
            width:85%;
            max-width:350px;
            text-align:center;
        }

        .phone-box {
            background:white;
            color:black;
            border:none;
        }
    </style>
</head>
<body>

<img src="https://raw.githubusercontent.com/MarahKamalJaber/beast/main/logo.png" class="logo">

<div class="machine">
    <div class="screen">
        <div id="r1" class="reel">ğŸ”</div>
        <div id="r2" class="reel">ğŸ¥—</div>
        <div id="r3" class="reel">ğŸ–</div>
    </div>

    <!-- ğŸ”¥ Ø§Ù„Ø°Ø±Ø§Ø¹ -->
    <div class="lever-box">
        <div id="lever" class="lever">
            <div class="lever-stick"></div>
            <div class="lever-ball"></div>
        </div>
    </div>
</div>

<div class="instructions">
ğŸ˜ˆ Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ ÙˆØ¬Ø±Ø¨ Ø­Ø¸Ù‘Ùƒ Ù…Ø¹ Ø§Ù„ÙˆØ­Ø´<br>
ğŸ¯ Ù…Ù…ÙƒÙ† ØªØ±Ø¨Ø­ Ø¨Ø±Ø¬Ø±ØŒ Ø³Ù„Ø·Ø©ØŒ Ø£Ø¬Ù†Ø­Ø©<br><br>
ğŸ‘‰ <b>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø°Ø±Ø§Ø¹ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</b>
</div>

<!-- Ù†ØªÙŠØ¬Ø© -->
<div id="popup">
    <div class="popup-box">
        <h2 id="popupTitle">Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ!</h2>
        <div id="popupEmoji" style="font-size:40px;">ğŸ”¥ğŸ”ğŸ”¥</div>
        <p id="popupMsg"></p>

        <a id="waLink" href="#" target="_blank"
           style="display:none;margin-top:15px;padding:12px;background:#25D366;color:white;
           border-radius:10px;font-size:18px;text-decoration:none;font-weight:bold;">
            ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“©
        </a>
    </div>
</div>

<!-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… -->
<div id="phonePopup" style="display:flex;">
    <div class="phone-box">
        <h2>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ</h2>
        <p>Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</p>
        <input id="phoneInput" type="tel" placeholder="059XXXXXXX"
               style="width:95%;padding:12px;border-radius:10px;border:2px solid #ff5a00;font-size:18px;">
        <button onclick="submitPhone()"
                style="margin-top:15px;width:100%;padding:12px;font-size:18px;background:#ff5a00;color:white;border:none;border-radius:10px;">
            Ù…ØªØ§Ø¨Ø¹Ø©
        </button>
    </div>
</div>

<script>
/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

const API_URL = "/api/proxy";

let deviceId = null;
let phone = "";
let allowed = false;
let spinning = false;

const popup = document.getElementById("popup");
const popupTitle = document.getElementById("popupTitle");
const popupEmoji = document.getElementById("popupEmoji");
const popupMsg = document.getElementById("popupMsg");
const waLink = document.getElementById("waLink");
const phonePopup = document.getElementById("phonePopup");
const phoneInput = document.getElementById("phoneInput");
const lever = document.getElementById("lever");

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (0) Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

function persistIdEverywhere(id) {
    try { localStorage.setItem("bbid", id); } catch(e) {}
    try {
        document.cookie = "bbid=" + id + "; max-age=31536000; path=/";
    } catch(e) {}
}

function openBbidDb() {
    return new Promise((resolve) => {
        if (!window.indexedDB) return resolve(null);
        const req = indexedDB.open("BBID_DB", 1);
        req.onupgradeneeded = (e) => {
            e.target.result.createObjectStore("store");
        };
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => resolve(null);
    });
}

async function sha256(str) {
    if (!(window.crypto && crypto.subtle && window.TextEncoder)) {
        // fallback Ù„Ùˆ Ø§Ù„Ù…ØªØµÙØ­ Ù‚Ø¯ÙŠÙ…
        return (Math.random().toString(36).slice(2) + Date.now().toString(36));
    }
    const enc = new TextEncoder();
    const data = enc.encode(str);
    const buf = await crypto.subtle.digest("SHA-256", data);
    const arr = Array.from(new Uint8Array(buf));
    return arr.map(b => b.toString(16).padStart(2,"0")).join("");
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (1) ØªÙˆÙ„ÙŠØ¯ Ø¨ØµÙ…Ø© Ø¬Ù‡Ø§Ø² Ù‚ÙˆÙŠØ© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

async function getSuperDeviceId() {
    const db = await openBbidDb();

    // 1) Ù‡Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ IndexedDBØŸ
    if (db) {
        const saved = await new Promise((resolve) => {
            const tx = db.transaction("store", "readonly");
            const store = tx.objectStore("store");
            const g = store.get("bbid");
            g.onsuccess = () => resolve(g.result || null);
            g.onerror = () => resolve(null);
        });
        if (saved) {
            persistIdEverywhere(saved);
            return saved;
        }
    }

    // 2) Ù‡Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ localStorageØŸ
    let ls = null;
    try {
        ls = localStorage.getItem("bbid");
    } catch(e) {}
    if (ls) {
        if (db) {
            const tx = db.transaction("store", "readwrite");
            tx.objectStore("store").put(ls, "bbid");
        }
        persistIdEverywhere(ls);
        return ls;
    }

    // 3) ØªÙˆÙ„ÙŠØ¯ ID Ø¬Ø¯ÙŠØ¯ Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
    let ua = navigator.userAgent || "";
    // Ø¥Ø²Ø§Ù„Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø¹Ø´Ø§Ù† Ù†ÙˆØ­Ø¯ Ø§Ù„Ø¨ØµÙ…Ø© Ø¨ÙŠÙ† Chrome / Edge / Instagram WebView Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†
    ua = ua.replace(/(Chrome|CriOS|Edg|OPR|Mobile Safari|Instagram|FBAN|FBAV)\/[^\s]+/g, "");

    const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone || "");
    const raw = [
        ua,
        screen && screen.width,
        screen && screen.height,
        screen && screen.colorDepth,
        navigator.language || "",
        tz
    ].join("|");

    const hash = await sha256(raw);
    const newId = "D_" + hash.slice(0, 20);

    if (db) {
        const tx = db.transaction("store", "readwrite");
        tx.objectStore("store").put(newId, "bbid");
    }
    persistIdEverywhere(newId);
    return newId;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (2) ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙØªØ­ Ø§Ù„ØµÙØ­Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

async function checkDevice() {
    if (!deviceId) return;

    const params = new URLSearchParams({
        action: "checkDeviceOnly",
        deviceId: deviceId
    });

    try {
        const res = await fetch(`${API_URL}?${params}`).then(r => r.json());

        if (!res.allowed) {
            phonePopup.style.display = "none";
            document.querySelector(".machine").style.display = "none";
            lever.style.pointerEvents = "none";

            document.querySelector(".instructions").innerHTML = `
                <h2 style="font-size:26px;margin-bottom:10px;">ğŸš« Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨</h2>
                <p style="font-size:20px;">Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ˜ˆ</p>
            `;

            allowed = false;
            spinning = true;
        }
    } catch (e) {
        console.error("checkDevice error:", e);
    }
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (3) ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

document.addEventListener("DOMContentLoaded", async () => {
    deviceId = await getSuperDeviceId();
    await checkDevice();
});

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (4) Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

async function submitPhone() {
    if (!deviceId) {
        alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø© ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        return;
    }

    phone = phoneInput.value.trim();
    if (phone.length < 7) return alert("Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­");

    const params = new URLSearchParams({
        action: "checkPhone",
        phone: phone,
        deviceId: deviceId
    });

    try {
        const res = await fetch(`${API_URL}?${params}`).then(r => r.json());

        if (!res.allowed) {
            if (res.reason === "device_exists")
                return alert("Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ğŸ˜ˆ");
            if (res.reason === "phone_exists")
                return alert("Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ø¹Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ğŸ˜ˆ");
            if (res.reason === "ip_exists")
                return alert("Ù‡Ø°Ø§ Ø§Ù„Ø§ØªØµØ§Ù„ (IP) Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ğŸ˜ˆ");
            return alert("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„Ù„Ø¹Ø¨.");
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©
        fetch(API_URL, {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({
                action: "registerPhone",
                phone: phone,
                deviceId: deviceId
            })
        });

        phonePopup.style.display = "none";
        allowed = true;
    } catch (e) {
        console.error("submitPhone error:", e);
        alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
    }
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (5) Ø§Ù„Ø°Ø±Ø§Ø¹ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

lever.onclick = function () {
    if (!allowed) return alert("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹");
    if (spinning) return;

    spinning = true;
    startSpin();

    fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            action: "played",
            phone: phone,
            deviceId: deviceId
        })
    });
};

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (6) Ø§Ù„Ø³Ø¨ÙŠÙ† â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

function startSpin() {
    let result = [];
    const symbols = ["ğŸ”","ğŸ¥—","ğŸ–","ğŸŸ"];

    const isWin = Math.random() < 0.10;
    let forcedType = null;

    if (isWin) {
        const r = Math.random();
        if (r < 0.01) forcedType = "burger";
        else if (r < 0.46) forcedType = "salad";
        else forcedType = "wings";
    }

    ["r1","r2","r3"].forEach((id, idx) => {
        let reel = document.getElementById(id);

        let interval = setInterval(() => {
            reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
        }, 80);

        setTimeout(() => {
            clearInterval(interval);

            let final = forcedType
                ? (forcedType === "burger" ? "ğŸ”"
                    : forcedType === "salad" ? "ğŸ¥—"
                    : "ğŸ–")
                : symbols[Math.floor(Math.random() * symbols.length)];

            reel.textContent = final;
            result[idx] = final;

            if (idx === 2)
                setTimeout(() => checkResult(result, forcedType), 600);

        }, 4200 + idx * 400);
    });
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (7) Ø§Ù„Ù†ØªÙŠØ¬Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

function checkResult(arr, forced) {
    if (forced) {
        spinning = false;
        allowed = false;
        return showWin(forced);
    }

    if (arr[0] === arr[1] && arr[1] === arr[2]) {
        if (arr[0] === "ğŸ”") return showWin("burger");
        if (arr[0] === "ğŸ¥—") return showWin("salad");
        if (arr[0] === "ğŸ–") return showWin("wings");
    }

    spinning = false;
    allowed = false;
    showLose();
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (8) Ø§Ù„ÙÙˆØ² â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

function showWin(type) {
    popup.style.display = "flex";
    popupTitle.textContent = "Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ! ğŸ‰";

    if (type === "burger") {
        popupEmoji.textContent = "ğŸ”";
        popupMsg.textContent = "Ø±Ø¨Ø­Øª ÙˆØ¬Ø¨Ø© Ø¨Ø±ØºØ±!";
    } else if (type === "salad") {
        popupEmoji.textContent = "ğŸ¥—";
        popupMsg.textContent = "Ø±Ø¨Ø­Øª Ø³Ù„Ø·Ø©!";
    } else {
        popupEmoji.textContent = "ğŸ–";
        popupMsg.textContent = "Ø±Ø¨Ø­Øª Ø£Ø¬Ù†Ø­Ø©!";
    }

    waLink.href = `https://wa.me/972599443332?text=${encodeURIComponent("Ø±Ø¨Ø­Øª Ù…Ù† Ù„Ø¹Ø¨Ø© Beast Burger ğŸ‰")}`;
    waLink.style.display = "block";
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (9) Ø§Ù„Ø®Ø³Ø§Ø±Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

function showLose() {
    popup.style.display = "flex";
    popupTitle.textContent = "Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ± ğŸ˜ˆ";
    popupEmoji.textContent = "ğŸ˜ˆ";
    popupMsg.textContent = "Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ±!";
    waLink.style.display = "none";
}
</script>

</body>
</html>
