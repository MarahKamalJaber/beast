<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Beast Burger Spin</title>

<script async src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js"></script>

<style>
body{
  margin:0; padding:0;
  font-family:'Cairo',sans-serif;
  background:#7a1824; color:#fff; text-align:center;
  overflow-x:hidden;
}
body::before{
  content:"BEAST BURGER BEAST BURGER BEAST BURGER BEAST BURGER ";
  position:fixed; top:-15%; left:-25%;
  width:180%; height:180%;
  font-size:80px; font-weight:900;
  color:rgba(0,0,0,0.12);
  transform:rotate(-28deg); z-index:-1;
}
.logo{ width:135px; margin:25px auto 10px; display:block; }

.machine{
  width:92%; max-width:480px; margin:35px auto 0;
  background:linear-gradient(180deg,#ff8a20,#ff5a00);
  padding:28px 20px 40px;
  border-radius:38px;
  box-shadow:0 0 50px rgba(0,0,0,0.45);
  position:relative;
}
.screen{
  background:#0a0607; border-radius:28px;
  padding:30px 20px;
  display:flex; justify-content:space-between; align-items:center;
}
.reel{
  width:90px; height:90px; background:#1a0f13;
  border-radius:20px; font-size:52px;
  display:flex; justify-content:center; align-items:center;
}
@media(max-width:600px){
  .reel{ width:72px;height:72px;font-size:44px; }
}

.lever-box{ position:absolute; left:-5px; bottom:-40px; transform:rotate(12deg); }
.lever{ cursor:pointer; width:90px; transition:.25s ease; }
.lever.active{ transform:rotate(25deg) translateY(10px); }
.lever-stick{ width:16px;height:90px;background:#000;border-radius:10px;margin:0 auto; }
.lever-ball{ width:55px;height:55px;background:#ffb58d;border-radius:50%;box-shadow:0 6px 12px rgba(0,0,0,0.55);margin-top:-12px;}

.instructions{ margin-top:50px;font-size:18px;line-height:1.7;padding:0 10px; }

/* Popup */
#popup{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.85);
  display:none; justify-content:center; align-items:center;
  z-index:999;
}
.popup-box{
  background:#0f0a0a; border:3px solid #ff6a00;
  padding:25px; border-radius:18px;
  width:85%; max-width:350px; text-align:center;
}
.win-emoji{ font-size:60px; margin-bottom:10px; }

/* Phone Popup */
#phonePopup{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.85);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
}
.phone-box{
  background:white; color:black; padding:25px;
  border-radius:15px; width:85%; max-width:320px;
  text-align:center;
}
</style>
</head>

<body>

    <img src="https://beastburger2025.neocities.org/logo.png" class="logo">

    <div class="machine">
        <div class="screen">
            <div id="r1" class="reel">ğŸ”</div>
            <div id="r2" class="reel">ğŸ¥—</div>
            <div id="r3" class="reel">ğŸ–</div>
        </div>

        <div class="lever-box">
            <div id="lever" class="lever">
                <div class="lever-stick"></div>
                <div class="lever-ball"></div>
            </div>
        </div>
    </div>

    <div class="instructions">
        ğŸ˜ˆ Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ ÙˆØ¬Ø±Ø¨ Ø­Ø¸Ù‘Ùƒ Ù…Ø¹ Ø§Ù„ÙˆØ­Ø´
        ğŸ¯ Ù…Ù…ÙƒÙ† ØªØ±Ø¨Ø­ Ø¨Ø±Ø¬Ø±ØŒ Ø³Ù„Ø·Ø©ØŒ Ø£Ø¬Ù†Ø­Ø©
    </div>

    <!-- WIN POPUP -->
    <div id="popup">
        <div class="popup-box">
            <div class="win-emoji" id="popupEmoji">ğŸ”¥ğŸ”ğŸ”¥</div>
            <h2 id="popupTitle">Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ!</h2>
            <p id="popupMsg"></p>
            <a id="waLink" class="whatsapp-btn" target="_blank">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
        </div>
    </div>


    <!-- PHONE SCREEN -->
    <div id="phonePopup">
        <div class="phone-box">
            <h2>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ</h2>
            <p>Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</p>
            <input id="phoneInput" type="tel" placeholder="059XXXXXXX"
                   style="width:95%;padding:12px;border-radius:10px;border:2px solid #ff5a00;font-size:18px;">
            <button onclick="submitPhone()"
                    style="margin-top:15px;width:100%;padding:12px;font-size:18px;background:#ff5a00;color:white;border:none;border-radius:10px;">
                Ù…ØªØ§Ø¨Ø¹Ø©
            </button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyB58-gypOKNF9ENFunruEqB2FbnwKbOFptANh860N_oERW6lKus7CHdBFADLs4c4U/exec";

        let deviceId = null;
        let phone = "";
        let fingerprintLoaded = false;
        let allowed = false;

        const winChance = 0.10;
        const symbols = ["ğŸ”", "ğŸ¥—", "ğŸ–", "ğŸŸ"];
        const reelsIds = ["r1", "r2", "r3"];

        /* === Fingerprint === */
        function initFP() {
            if (!window.FingerprintJS) {
                deviceId = "fallback_" + Math.random().toString(36).slice(2);
                fingerprintLoaded = true;
                return;
            }

            FingerprintJS.load()
                .then(fp => fp.get())
                .then(res => {
                    deviceId = res.visitorId;
                    fingerprintLoaded = true;
                })
                .catch(() => {
                    deviceId = "fallback_" + Math.random().toString(36).slice(2);
                    fingerprintLoaded = true;
                });
        }
        setTimeout(initFP, 600);

        /* === Submit Phone === */
        function submitPhone() {

            if (!fingerprintLoaded) {
                alert("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ...");
                return;
            }

            phone = document.getElementById("phoneInput").value.trim();

            if (phone.length < 7) {
                alert("Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­");
                return;
            }

            fetch(`${API_URL}?action=checkPhone&phone=${phone}&deviceId=${deviceId}`)
                .then(r => r.json())
                .then(res => {
                    if (!res.allowed) {
                        alert("Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø´Ø§Ø±Ùƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ğŸ˜ˆ");
                        return;
                    }

                    fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: "registerPhone",
                            phone: phone,
                            deviceId: deviceId
                        })
                    });

                    document.getElementById("phonePopup").style.display = "none";
                    allowed = true;
                })
                .catch(err => {
                    console.log("ERROR:", err);
                    alert("Ù…Ø´ÙƒÙ„Ø© Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
                });
        }

        /* === Lever click === */
        document.getElementById("lever").onclick = function () {

            if (!allowed) {
                alert("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }

            this.classList.add("active");
            setTimeout(() => this.classList.remove("active"), 300);

            startSpin();

            fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    action: "played",
                    phone: phone,
                    deviceId: deviceId
                })
            });
        };


        /* === Spin === */
        function startSpin() {
            let result = [];
            const isWin = Math.random() < winChance;

            let forcedType = null;
            if (isWin) {
                let r = Math.random();
                if (r < 0.10) forcedType = "burger";
                else if (r < 0.55) forcedType = "salad";
                else forcedType = "wings";
            }

            reelsIds.forEach((id, idx) => {
                let reel = document.getElementById(id);

                let interval = setInterval(() => {
                    reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                }, 80);

                setTimeout(() => {
                    clearInterval(interval);

                    let final;
                    if (forcedType) {
                        final = forcedType === "burger" ? "ğŸ”" :
                            forcedType === "salad" ? "ğŸ¥—" :
                                "ğŸ–";
                    } else {
                        final = symbols[Math.floor(Math.random() * symbols.length)];
                    }

                    reel.textContent = final;
                    result[idx] = final;

                    if (idx === 2) {
                        setTimeout(() => checkResult(result, forcedType), 500);
                    }

                }, 4200 + idx * 400);
            });
        }

        /* === Result === */
        function checkResult(arr, forced) {
            if (forced) return showWin(forced);

            if (arr[0] === arr[1] && arr[1] === arr[2]) {
                if (arr[0] === "ğŸ”") return showWin("burger");
                if (arr[0] === "ğŸ¥—") return showWin("salad");
                if (arr[0] === "ğŸ–") return showWin("wings");
            }

            showLose();
        }

        function showWin(type) {
            document.getElementById("popup").style.display = "flex";

            if (type === "burger") {
                popupEmoji.textContent = "ğŸ”";
                popupMsg.textContent = "Ø±Ø¨Ø­Øª ÙˆØ¬Ø¨Ø© Ø¨Ø±ØºØ± Ù…Ø¬Ø§Ù†ÙŠØ©!";
            }
            if (type === "salad") {
                popupEmoji.textContent = "ğŸ¥—";
                popupMsg.textContent = "Ø±Ø¨Ø­Øª Ø³Ù„Ø·Ø© Ø§Ù„Ø¨ÙŠØ³Øª!";
            }
            if (type === "wings") {
                popupEmoji.textContent = "ğŸ–";
                popupMsg.textContent = "Ø±Ø¨Ø­Øª ÙˆØ¬Ø¨Ø© Ø£Ø¬Ù†Ø­Ø©!";
            }
        }

        function showLose() {
            document.getElementById("popup").style.display = "flex";
            popupEmoji.textContent = "ğŸ˜ˆ";
            popupMsg.textContent = "Ù„Ù„Ø£Ø³Ù Ù…Ø§ Ø±Ø¨Ø­Øª Ù‡Ø§Ù„Ù…Ø±Ø©!";
            waLink.style.display = "none";
        }
    </script>


</body>
</html>
