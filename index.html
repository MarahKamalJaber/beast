<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Beast Burger Spin</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
            background: #7a1824;
            color: #fff;
            text-align: center;
            overflow-x: hidden;
        }

        body::before {
            content: "BEAST BURGER BEAST BURGER BEAST BURGER BEAST BURGER ";
            position: fixed;
            top: -15%;
            left: -25%;
            width: 180%;
            height: 180%;
            font-size: 80px;
            font-weight: 900;
            color: rgba(0,0,0,0.12);
            transform: rotate(-28deg);
            z-index: -1;
        }

        .logo {
            width: 135px;
            margin: 25px auto 10px;
            display: block;
        }

        .machine {
            width: 92%;
            max-width: 480px;
            margin: 35px auto 0;
            background: linear-gradient(180deg,#ff8a20,#ff5a00);
            padding: 28px 20px 40px;
            border-radius: 38px;
            box-shadow: 0 0 50px rgba(0,0,0,0.45);
            position: relative;
        }

        .screen {
            background: #0a0607;
            border-radius: 28px;
            padding: 30px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reel {
            width: 90px;
            height: 90px;
            background: #1a0f13;
            border-radius: 20px;
            font-size: 52px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @media(max-width:600px) {
            .reel {
                width: 72px;
                height: 72px;
                font-size: 44px;
            }
        }

        .lever-box {
            position: absolute;
            left: -5px;
            bottom: -40px;
            transform: rotate(12deg);
        }

        .lever {
            cursor: pointer;
            width: 90px;
            transition: .25s ease;
        }

        .lever.active {
            transform: rotate(25deg) translateY(10px);
        }

        .lever-stick {
            width: 16px;
            height: 90px;
            background: #000;
            border-radius: 10px;
            margin: 0 auto;
        }

        .lever-ball {
            width: 55px;
            height: 55px;
            background: #ffb58d;
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(0,0,0,0.55);
            margin-top: -12px;
        }

        .instructions {
            margin-top: 50px;
            font-size: 18px;
            line-height: 1.7;
            padding: 0 10px;
        }

        #popup, #phonePopup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .popup-box, .phone-box {
            background: #0f0a0a;
            border: 3px solid #ff6a00;
            padding: 25px;
            border-radius: 18px;
            width: 85%;
            max-width: 350px;
            text-align: center;
        }

        .phone-box {
            background: white;
            color: black;
            border: none;
        }
    </style>
</head>

<body>

<img src="https://raw.githubusercontent.com/MarahKamalJaber/beast/main/logo.png" class="logo">

<div class="machine">
    <div class="screen">
        <div id="r1" class="reel">ğŸ”</div>
        <div id="r2" class="reel">ğŸ¥—</div>
        <div id="r3" class="reel">ğŸ–</div>
    </div>
    <div class="lever-box">
        <div id="lever" class="lever">
            <div class="lever-stick"></div>
            <div class="lever-ball"></div>
        </div>
    </div>
</div>

<div class="instructions">
ğŸ˜ˆ Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ ÙˆØ¬Ø±Ø¨ Ø­Ø¸Ù‘Ùƒ Ù…Ø¹ Ø§Ù„ÙˆØ­Ø´<br>
ğŸ¯ Ù…Ù…ÙƒÙ† ØªØ±Ø¨Ø­ Ø¨Ø±Ø¬Ø±ØŒ Ø³Ù„Ø·Ø©ØŒ Ø£Ø¬Ù†Ø­Ø©<br><br>
ğŸ‘‰ <b>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø°Ø±Ø§Ø¹ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</b>
</div>


<!-- RESULTS POPUP -->
<div id="popup">
    <div class="popup-box">
        <h2 id="popupTitle">Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ!</h2>
        <div id="popupEmoji" style="font-size:40px;">ğŸ”¥ğŸ”ğŸ”¥</div>
        <p id="popupMsg"></p>
        <a id="waLink" href="#" target="_blank" style="display:none;margin-top:15px;
           padding:12px;background:#25D366;color:white;border-radius:10px;font-size:18px;
           text-decoration:none;font-weight:bold;display:block;">
            ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“©
        </a>
    </div>
</div>

<!-- PHONE INPUT POPUP -->
<div id="phonePopup" style="display:flex;">
    <div class="phone-box">
        <h2>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ</h2>
        <p>Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</p>
        <input id="phoneInput" type="tel" placeholder="059XXXXXXX"
               style="width:95%;padding:12px;border-radius:10px;border:2px solid #ff5a00;font-size:18px;">
        <button onclick="submitPhone()"
                style="margin-top:15px;width:100%;padding:12px;font-size:18px;background:#ff5a00;color:white;border:none;border-radius:10px;">
            Ù…ØªØ§Ø¨Ø¹Ø©
        </button>
    </div>
</div>

<script src="client.min.js"></script>

<script>
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (1) Ø¨ØµÙ…Ø© Ø«Ø§Ø¨ØªØ© + LocalStorage â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

function stableDeviceId() {
    const client = new ClientJS();
    const f1 = client.getFingerprint();
    const f2 = navigator.userAgent;
    const f3 = screen.width + "x" + screen.height;

    const raw = f1 + "|" + f2 + "|" + f3;

    let hash = 0;
    for (let i = 0; i < raw.length; i++) {
        hash = (hash << 5) - hash + raw.charCodeAt(i);
        hash |= 0;
    }
    return "D" + Math.abs(hash);
}

let deviceId = localStorage.getItem("device_key");
if (!deviceId) {
    deviceId = stableDeviceId();
    localStorage.setItem("device_key", deviceId);
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (2) Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

const API_URL = "/api/proxy";

let phone = "";
let allowed = false;
let spinning = false;

const popup = document.getElementById("popup");
const popupTitle = document.getElementById("popupTitle");
const popupEmoji = document.getElementById("popupEmoji");
const popupMsg = document.getElementById("popupMsg");
const waLink = document.getElementById("waLink");
const phonePopup = document.getElementById("phonePopup");
const phoneInput = document.getElementById("phoneInput");
const lever = document.getElementById("lever");

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (3) Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ + ÙØ­Øµ Ø¬Ù‡Ø§Ø² + Ø±Ù‚Ù… Ù…Ø¹Ø§Ù‹ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

function submitPhone() {
    phone = phoneInput.value.trim();

    if (phone.length < 7) {
        alert("Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­");
        return;
    }

    const params = new URLSearchParams({
        action: "checkPlayer",
        phone: phone,
        deviceId: deviceId
    });

    fetch(`${API_URL}?${params.toString()}`)
        .then(r => r.json())
        .then(res => {
            if (!res || res.error) {
                alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                return;
            }

            if (!res.allowed) {
                if (res.reason === "device_exists") {
                    alert("Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ˜ˆ");
                    return;
                }

                if (res.reason === "phone_exists") {
                    alert("Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ø¹Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ˜ˆ");
                    return;
                }

                alert("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„Ù„Ø¹Ø¨.");
                return;
            }

            // Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯ + Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯ â†’ Ù†Ø³Ø¬Ù‘Ù„Ù‡Ù…
            fetch(API_URL, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    action: "registerPhone",
                    phone: phone,
                    deviceId: deviceId
                })
            }).catch(err => console.error("ERROR saving phone:", err));

            phonePopup.style.display = "none";
            allowed = true;
        })
        .catch(err => {
            console.error("ERROR checkPlayer:", err);
            alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.");
        });
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (4) Ø§Ù„Ø³Ø­Ø¨ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

lever.onclick = function () {
    if (!allowed) {
        alert("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }

    if (spinning) return;
    spinning = true;

    startSpin();

    fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            action: "played",
            phone: phone,
            deviceId: deviceId
        })
    }).catch(err => console.error("ERROR played:", err));
};

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (5) Ø§Ù„Ø³Ø¨ÙŠÙ† â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

function startSpin() {
    let result = [];
    const symbols = ["ğŸ”", "ğŸ¥—", "ğŸ–", "ğŸŸ"];

    const isWin = Math.random() < 0.10;
    let forcedType = null;

    if (isWin) {
        let r = Math.random();
        if (r < 0.01) forcedType = "burger";
        else if (r < 0.46) forcedType = "salad";
        else forcedType = "wings";
    }

    ["r1", "r2", "r3"].forEach((id, idx) => {
        let reel = document.getElementById(id);

        let interval = setInterval(() => {
            reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
        }, 80);

        setTimeout(() => {
            clearInterval(interval);

            let final = forcedType
                ? (forcedType === "burger" ? "ğŸ”" : forcedType === "salad" ? "ğŸ¥—" : "ğŸ–")
                : symbols[Math.floor(Math.random() * symbols.length)];

            reel.textContent = final;
            result[idx] = final;

            if (idx === 2) {
                setTimeout(() => checkResult(result, forcedType), 500);
            }

        }, 4200 + idx * 400);
    });
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (6) ÙØ­Øµ Ø§Ù„Ù†ØªÙŠØ¬Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

function checkResult(arr, forced) {
    if (forced) {
        spinning = false;
        allowed = false;
        return showWin(forced);
    }

    if (arr[0] === arr[1] && arr[1] === arr[2]) {
        if (arr[0] === "ğŸ”") return showWin("burger");
        if (arr[0] === "ğŸ¥—") return showWin("salad");
        if (arr[0] === "ğŸ–") return showWin("wings");
    }

    spinning = false;
    allowed = false;
    showLose();
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (7) Ø§Ù„ÙÙˆØ² â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

function showWin(type) {
    popup.style.display = "flex";
    popupTitle.textContent = "Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ! ğŸ‰";

    if (type === "burger") {
        popupEmoji.textContent = "ğŸ”";
        popupMsg.textContent = "Ø±Ø¨Ø­Øª ÙˆØ¬Ø¨Ø© Ø¨Ø±ØºØ±!";
    } else if (type === "salad") {
        popupEmoji.textContent = "ğŸ¥—";
        popupMsg.textContent = "Ø±Ø¨Ø­Øª Ø³Ù„Ø·Ø©!";
    } else {
        popupEmoji.textContent = "ğŸ–";
        popupMsg.textContent = "Ø±Ø¨Ø­Øª Ø£Ø¬Ù†Ø­Ø©!";
    }

    let msg = `Ù…Ø±Ø­Ø¨Ø§ØŒ Ø±Ø¨Ø­Øª Ù…Ù† Ù„Ø¹Ø¨Ø© Beast Burger ğŸ‰`;
    waLink.href = `https://wa.me/972599443332?text=${encodeURIComponent(msg)}`;
    waLink.style.display = "block";
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” (8) Ø§Ù„Ø®Ø³Ø§Ø±Ø© â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” //

function showLose() {
    popup.style.display = "flex";
    popupTitle.textContent = "Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ± ğŸ˜ˆ";
    popupEmoji.textContent = "ğŸ˜ˆ";
    popupMsg.textContent = "Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ±!";
    waLink.style.display = "none";
}
</script>

</body>
</html>
