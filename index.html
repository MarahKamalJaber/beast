<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Beast Burger Spin</title>

    <style>
        body {
            margin: 0; padding: 0;
            font-family: 'Cairo', sans-serif;
            background: #7a1824;
            color: #fff; text-align: center;
        }
        body::before {
            content: "BEAST BURGER BEAST BURGER BEAST BURGER ";
            position: fixed;
            top: -10%; left: -20%;
            width: 180%; height: 180%;
            font-size: 80px; font-weight: 900;
            color: rgba(0,0,0,0.12);
            transform: rotate(-28deg);
            z-index: -1;
        }
        .logo { width:130px; margin:25px auto 10px; display:block; }

        .machine {
            width: 92%; max-width:480px; margin:35px auto 0;
            background: linear-gradient(180deg,#ff8a20,#ff5a00);
            padding: 28px 20px 40px;
            border-radius: 38px;
            box-shadow: 0 0 50px rgba(0,0,0,0.45);
            position: relative;
        }

        .screen {
            background:#0a0607; padding:30px 20px;
            border-radius:28px;
            display:flex; justify-content:space-between;
        }

        .reel {
            width: 90px; height: 90px;
            background:#1a0f13; border-radius:20px;
            display:flex; justify-content:center; align-items:center;
            font-size:50px;
        }

        #popup, #phonePopup {
            position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.85);
            display:none; justify-content:center; align-items:center;
            z-index:9999;
        }

        .popup-box, .phone-box {
            background:#0f0a0a; border:3px solid #ff6a00;
            padding:25px; border-radius:18px;
            width:85%; max-width:350px;
            text-align:center;
        }
        .phone-box {
            background:white; color:black; border:none;
        }
    </style>
</head>

<body>

<img src="https://raw.githubusercontent.com/MarahKamalJaber/beast/main/logo.png" class="logo">

<div class="machine">
    <div class="screen">
        <div id="r1" class="reel">ğŸ”</div>
        <div id="r2" class="reel">ğŸ¥—</div>
        <div id="r3" class="reel">ğŸ–</div>
    </div>

    <div class="lever-box">
        <div id="lever" class="lever" style="cursor:pointer;">
            <div style="width:16px;height:90px;background:#000;border-radius:10px;margin:0 auto;"></div>
            <div style="width:55px;height:55px;background:#ffb58d;border-radius:50%;margin-top:-12px;box-shadow:0 5px 10px rgba(0,0,0,0.5);"></div>
        </div>
    </div>
</div>

<div class="instructions">
    ğŸ˜ˆ Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ ÙˆØ¬Ø±Ø¨ Ø­Ø¸Ù‘Ùƒ Ù…Ø¹ Ø§Ù„ÙˆØ­Ø´<br>
    ğŸ¯ Ù…Ù…ÙƒÙ† ØªØ±Ø¨Ø­ Ø¨Ø±Ø¬Ø±ØŒ Ø³Ù„Ø·Ø©ØŒ Ø£Ø¬Ù†Ø­Ø©<br><br>
    ğŸ‘‰ <b>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø°Ø±Ø§Ø¹ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</b>
</div>

<!-- Ù†ØªÙŠØ¬Ø© -->
<div id="popup">
    <div class="popup-box">
        <h2 id="popupTitle">Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ!</h2>
        <div id="popupEmoji" style="font-size:40px;">ğŸ”¥ğŸ”ğŸ”¥</div>
        <p id="popupMsg"></p>
        <a id="waLink"
           style="display:none;margin-top:15px;padding:12px;background:#25D366;
           color:white;border-radius:10px;font-size:18px;text-decoration:none;font-weight:bold;">
            ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“©
        </a>
    </div>
</div>

<!-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… -->
<div id="phonePopup" style="display:flex;">
    <div class="phone-box">
        <h2>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ</h2>
        <p>Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</p>
        <input id="phoneInput" type="tel" placeholder="059XXXXXXX"
               style="width:95%;padding:12px;border-radius:10px;border:2px solid #ff5a00;font-size:18px;">
        <button onclick="submitPhone()"
                style="margin-top:15px;width:100%;padding:12px;font-size:18px;background:#ff5a00;color:white;border:none;border-radius:10px;">
            Ù…ØªØ§Ø¨Ø¹Ø©
        </button>
    </div>
</div>

<script src="client.min.js"></script>

<script>
/* ------------------------------------------------------------------
   ğŸ”¥ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± â€” Ø¬Ù‡Ø§Ø² ÙˆØ§Ø­Ø¯ = ÙØ±ØµØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
   ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰: ÙƒÙ„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª + Instagram + Messenger + Opera + Edge + TikTok
------------------------------------------------------------------ */

// Ø¥Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ø¹Ø¨ Ù‚Ø¨Ù„ â€” Ù…Ù…Ù†ÙˆØ¹ ÙÙˆØ±Ø§Ù‹
if (localStorage.getItem("bb_device_lock") === "LOCKED") {
    blockDeviceForever();
}

function blockDeviceForever() {
    document.querySelector(".machine").style.display = "none";
    document.getElementById("phonePopup").style.display = "none";
    document.querySelector(".instructions").innerHTML = `
        <h2 style="font-size:26px;">ğŸš« Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨</h2>
        <p style="font-size:20px;">Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ˜ˆ</p>
    `;
    allowed = false;
    spinning = true;
}

/* ------------------------------------------------------------------
   Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
------------------------------------------------------------------ */
const API_URL = "/api/proxy";
let deviceId = null;
let phone = "";
let allowed = false;
let spinning = false;

// DOM
const popup = document.getElementById("popup");
const popupTitle = document.getElementById("popupTitle");
const popupEmoji = document.getElementById("popupEmoji");
const popupMsg = document.getElementById("popupMsg");
const waLink = document.getElementById("waLink");
const phonePopup = document.getElementById("phonePopup");
const phoneInput = document.getElementById("phoneInput");
const lever = document.getElementById("lever");

/* ------------------------------------------------------------------
   ØªÙˆÙ„ÙŠØ¯ Ø¨ØµÙ…Ø© Ø¬Ù‡Ø§Ø² Ø«Ø§Ø¨ØªØ© â€” ClientJS
------------------------------------------------------------------ */
(function initDeviceId() {
    try {
        const client = new ClientJS();
        deviceId = "D_" + client.getFingerprint();
    } catch (e) {
        deviceId = "FB_" + Math.random().toString(36).slice(2);
    }
})();

/* ------------------------------------------------------------------
   ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£ÙˆÙ„ Ù…Ø§ ÙŠØ¯Ø®Ù„
------------------------------------------------------------------ */
(function checkDeviceServer() {
    const params = new URLSearchParams({
        action: "checkDeviceOnly",
        deviceId: deviceId
    });

    fetch(`${API_URL}?${params}`)
        .then(r => r.json())
        .then(res => {
            if (!res.allowed) {
                localStorage.setItem("bb_device_lock", "LOCKED");
                blockDeviceForever();
            }
        });
})();

/* ------------------------------------------------------------------
   Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
------------------------------------------------------------------ */
function submitPhone() {
    phone = phoneInput.value.trim();
    if (phone.length < 7) return alert("Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­");

    const params = new URLSearchParams({
        action: "checkPhone",
        phone: phone,
        deviceId: deviceId
    });

    fetch(`${API_URL}?${params}`)
        .then(r => r.json())
        .then(res => {
            if (!res.allowed) {
                alert("Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ğŸ˜ˆ");
                return;
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…
            fetch(API_URL, {
                method: "POST",
                headers: {"Content-Type":"application/json"},
                body: JSON.stringify({
                    action: "registerPhone",
                    phone: phone,
                    deviceId: deviceId
                })
            });

            phonePopup.style.display = "none";
            allowed = true;
        });
}

/* ------------------------------------------------------------------
   Ø§Ù„Ø³Ø­Ø¨
------------------------------------------------------------------ */
lever.onclick = function () {
    if (!allowed) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹");
    if (spinning) return;

    spinning = true;
    startSpin();

    // ğŸ”¥ Ù‚ÙÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
    localStorage.setItem("bb_device_lock", "LOCKED");

    // ØªØ³Ø¬ÙŠÙ„ Ù„Ø¹Ø¨
    fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            action: "played",
            phone: phone,
            deviceId: deviceId
        })
    });
};

/* ------------------------------------------------------------------
   Ø³Ø¨ÙŠÙ†
------------------------------------------------------------------ */
function startSpin() {
    let result = [];
    const symbols = ["ğŸ”","ğŸ¥—","ğŸ–","ğŸŸ"];
    const isWin = Math.random() < 0.10;
    let forced = null;

    if (isWin) {
        const r = Math.random();
        if (r < 0.01) forced = "burger";
        else if (r < 0.46) forced = "salad";
        else forced = "wings";
    }

    ["r1","r2","r3"].forEach((id, idx) => {
        let reel = document.getElementById(id);

        let interval = setInterval(() => {
            reel.textContent = symbols[Math.floor(Math.random()*symbols.length)];
        }, 80);

        setTimeout(() => {
            clearInterval(interval);
            let final = forced
                ? (forced==="burger"?"ğŸ”":forced==="salad"?"ğŸ¥—":"ğŸ–")
                : symbols[Math.floor(Math.random()*symbols.length)];

            reel.textContent = final;
            result[idx] = final;

            if (idx === 2)
                setTimeout(() => checkResult(result, forced), 600);

        }, 3500 + idx * 400);
    });
}

function checkResult(arr, forced) {
    if (forced) return showWin(forced);

    if (arr[0]===arr[1] && arr[1]===arr[2]) {
        if (arr[0]==="ğŸ”") return showWin("burger");
        if (arr[0]==="ğŸ¥—") return showWin("salad");
        if (arr[0]==="ğŸ–") return showWin("wings");
    }
    showLose();
}

function showWin(type) {
    popup.style.display="flex";
    popupTitle.textContent="Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ! ğŸ‰";

    if (type==="burger"){
        popupEmoji.textContent="ğŸ”";
        popupMsg.textContent="Ø±Ø¨Ø­Øª ÙˆØ¬Ø¨Ø© Ø¨Ø±ØºØ±!";
    } else if (type==="salad"){
        popupEmoji.textContent="ğŸ¥—";
        popupMsg.textContent="Ø±Ø¨Ø­Øª Ø³Ù„Ø·Ø©!";
    } else {
        popupEmoji.textContent="ğŸ–";
        popupMsg.textContent="Ø±Ø¨Ø­Øª Ø£Ø¬Ù†Ø­Ø©!";
    }
}

function showLose() {
    popup.style.display="flex";
    popupTitle.textContent="Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ± ğŸ˜ˆ";
    popupEmoji.textContent="ğŸ˜ˆ";
    popupMsg.textContent="Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰â€¦ Ø¨Ø³ Ù…Ø´ Ø§Ù„ÙŠÙˆÙ… ğŸ˜ˆ";
}
</script>

</body>
</html>
